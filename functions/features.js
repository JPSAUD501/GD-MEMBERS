const allEmojis = ["üòÄ","üòÅ","üòÇ","üòÉ","üòÑ","üòÖ","üòÜ","üòá","üòà","üëø","üòâ","üòä","‚ò∫Ô∏è","üòã","üòå","üòç","üòé","üòè","üòê","üòë","üòí","üòì","üòî","üòï","üòñ","üòó","üòò","üòô","üòö","üòõ","üòú","üòù","üòû","üòü","üò†","üò°","üò¢","üò£","üò§","üò•","üò¶","üòß","üò®","üò©","üò™","üò´","üò¨","üò≠","üòÆ","üòØ","üò∞","üò±","üò≤","üò≥","üò¥","üòµ","üò∂","üò∑","üò∏","üòπ","üò∫","üòª","üòº","üòΩ","üòæ","üòø","üôÄ","üë£","üë§","üë•","üë∂","üë∂üèª","üë∂üèº","üë∂üèΩ","üë∂üèæ","üë∂üèø","üë¶","üë¶üèª","üë¶üèº","üë¶üèΩ","üë¶üèæ","üë¶üèø","üëß","üëßüèª","üëßüèº","üëßüèΩ","üëßüèæ","üëßüèø","üë®","üë®üèª","üë®üèº","üë®üèΩ","üë®üèæ","üë®üèø","üë©","üë©üèª","üë©üèº","üë©üèΩ","üë©üèæ","üë©üèø","üë™","üë®‚Äçüë©‚Äçüëß","üë®‚Äçüë©‚Äçüëß‚Äçüë¶","üë®‚Äçüë©‚Äçüë¶‚Äçüë¶","üë®‚Äçüë©‚Äçüëß‚Äçüëß","üë©‚Äçüë©‚Äçüë¶","üë©‚Äçüë©‚Äçüëß","üë©‚Äçüë©‚Äçüëß‚Äçüë¶","üë©‚Äçüë©‚Äçüë¶‚Äçüë¶","üë©‚Äçüë©‚Äçüëß‚Äçüëß","üë®‚Äçüë®‚Äçüë¶","üë®‚Äçüë®‚Äçüëß","üë®‚Äçüë®‚Äçüëß‚Äçüë¶","üë®‚Äçüë®‚Äçüë¶‚Äçüë¶","üë®‚Äçüë®‚Äçüëß‚Äçüëß","üë´","üë¨","üë≠","üëØ","üë∞","üë∞üèª","üë∞üèº","üë∞üèΩ","üë∞üèæ","üë∞üèø","üë±","üë±üèª","üë±üèº","üë±üèΩ","üë±üèæ","üë±üèø","üë≤","üë≤üèª","üë≤üèº","üë≤üèΩ","üë≤üèæ","üë≤üèø","üë≥","üë≥üèª","üë≥üèº","üë≥üèΩ","üë≥üèæ","üë≥üèø","üë¥","üë¥üèª","üë¥üèº","üë¥üèΩ","üë¥üèæ","üë¥üèø","üëµ","üëµüèª","üëµüèº","üëµüèΩ","üëµüèæ","üëµüèø","üëÆ","üëÆüèª","üëÆüèº","üëÆüèΩ","üëÆüèæ","üëÆüèø","üë∑","üë∑üèª","üë∑üèº","üë∑üèΩ","üë∑üèæ","üë∑üèø","üë∏","üë∏üèª","üë∏üèº","üë∏üèΩ","üë∏üèæ","üë∏üèø","üíÇ","üíÇüèª","üíÇüèº","üíÇüèΩ","üíÇüèæ","üíÇüèø","üëº","üëºüèª","üëºüèº","üëºüèΩ","üëºüèæ","üëºüèø","üéÖ","üéÖüèª","üéÖüèº","üéÖüèΩ","üéÖüèæ","üéÖüèø","üëª","üëπ","üë∫","üí©","üíÄ","üëΩ","üëæ","üôá","üôáüèª","üôáüèº","üôáüèΩ","üôáüèæ","üôáüèø","üíÅ","üíÅüèª","üíÅüèº","üíÅüèΩ","üíÅüèæ","üíÅüèø","üôÖ","üôÖüèª","üôÖüèº","üôÖüèΩ","üôÖüèæ","üôÖüèø","üôÜ","üôÜüèª","üôÜüèº","üôÜüèΩ","üôÜüèæ","üôÜüèø","üôã","üôãüèª","üôãüèº","üôãüèΩ","üôãüèæ","üôãüèø","üôé","üôéüèª","üôéüèº","üôéüèΩ","üôéüèæ","üôéüèø","üôç","üôçüèª","üôçüèº","üôçüèΩ","üôçüèæ","üôçüèø","üíÜ","üíÜüèª","üíÜüèº","üíÜüèΩ","üíÜüèæ","üíÜüèø","üíá","üíáüèª","üíáüèº","üíáüèΩ","üíáüèæ","üíáüèø","üíë","üë©‚Äç‚ù§Ô∏è‚Äçüë©","üë®‚Äç‚ù§Ô∏è‚Äçüë®","üíè","üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë©","üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®","üôå","üôåüèª","üôåüèº","üôåüèΩ","üôåüèæ","üôåüèø","üëè","üëèüèª","üëèüèº","üëèüèΩ","üëèüèæ","üëèüèø","üëÇ","üëÇüèª","üëÇüèº","üëÇüèΩ","üëÇüèæ","üëÇüèø","üëÄ","üëÉ","üëÉüèª","üëÉüèº","üëÉüèΩ","üëÉüèæ","üëÉüèø","üëÑ","üíã","üëÖ","üíÖ","üíÖüèª","üíÖüèº","üíÖüèΩ","üíÖüèæ","üíÖüèø","üëã","üëãüèª","üëãüèº","üëãüèΩ","üëãüèæ","üëãüèø","üëç","üëçüèª","üëçüèº","üëçüèΩ","üëçüèæ","üëçüèø","üëé","üëéüèª","üëéüèº","üëéüèΩ","üëéüèæ","üëéüèø","‚òù","‚òùüèª","‚òùüèº","‚òùüèΩ","‚òùüèæ","‚òùüèø","üëÜ","üëÜüèª","üëÜüèº","üëÜüèΩ","üëÜüèæ","üëÜüèø","üëá","üëáüèª","üëáüèº","üëáüèΩ","üëáüèæ","üëáüèø","üëà","üëàüèª","üëàüèº","üëàüèΩ","üëàüèæ","üëàüèø","üëâ","üëâüèª","üëâüèº","üëâüèΩ","üëâüèæ","üëâüèø","üëå","üëåüèª","üëåüèº","üëåüèΩ","üëåüèæ","üëåüèø","‚úå","‚úåüèª","‚úåüèº","‚úåüèΩ","‚úåüèæ","‚úåüèø","üëä","üëäüèª","üëäüèº","üëäüèΩ","üëäüèæ","üëäüèø","‚úä","‚úäüèª","‚úäüèº","‚úäüèΩ","‚úäüèæ","‚úäüèø","‚úã","‚úãüèª","‚úãüèº","‚úãüèΩ","‚úãüèæ","‚úãüèø","üí™","üí™üèª","üí™üèº","üí™üèΩ","üí™üèæ","üí™üèø","üëê","üëêüèª","üëêüèº","üëêüèΩ","üëêüèæ","üëêüèø","üôè","üôèüèª","üôèüèº","üôèüèΩ","üôèüèæ","üôèüèø","üå±","üå≤","üå≥","üå¥","üåµ","üå∑","üå∏","üåπ","üå∫","üåª","üåº","üíê","üåæ","üåø","üçÄ","üçÅ","üçÇ","üçÉ","üçÑ","üå∞","üêÄ","üêÅ","üê≠","üêπ","üêÇ","üêÉ","üêÑ","üêÆ","üêÖ","üêÜ","üêØ","üêá","üê∞","üêà","üê±","üêé","üê¥","üêè","üêë","üêê","üêì","üêî","üê§","üê£","üê•","üê¶","üêß","üêò","üê™","üê´","üêó","üêñ","üê∑","üêΩ","üêï","üê©","üê∂","üê∫","üêª","üê®","üêº","üêµ","üôà","üôâ","üôä","üêí","üêâ","üê≤","üêä","üêç","üê¢","üê∏","üêã","üê≥","üê¨","üêô","üêü","üê†","üê°","üêö","üêå","üêõ","üêú","üêù","üêû","üêæ","‚ö°Ô∏è","üî•","üåô","‚òÄÔ∏è","‚õÖÔ∏è","‚òÅÔ∏è","üíß","üí¶","‚òîÔ∏è","üí®","‚ùÑÔ∏è","üåü","‚≠êÔ∏è","üå†","üåÑ","üåÖ","üåà","üåä","üåã","üåå","üóª","üóæ","üåê","üåç","üåé","üåè","üåë","üåí","üåì","üåî","üåï","üåñ","üåó","üåò","üåö","üåù","üåõ","üåú","üåû","üçÖ","üçÜ","üåΩ","üç†","üçá","üçà","üçâ","üçä","üçã","üçå","üçç","üçé","üçè","üçê","üçë","üçí","üçì","üçî","üçï","üçñ","üçó","üçò","üçô","üçö","üçõ","üçú","üçù","üçû","üçü","üç°","üç¢","üç£","üç§","üç•","üç¶","üçß","üç®","üç©","üç™","üç´","üç¨","üç≠","üçÆ","üçØ","üç∞","üç±","üç≤","üç≥","üç¥","üçµ","‚òïÔ∏è","üç∂","üç∑","üç∏","üçπ","üç∫","üçª","üçº","üéÄ","üéÅ","üéÇ","üéÉ","üéÑ","üéã","üéç","üéë","üéÜ","üéá","üéâ","üéä","üéà","üí´","‚ú®","üí•","üéì","üëë","üéé","üéè","üéê","üéå","üèÆ","üíç","‚ù§Ô∏è","üíî","üíå","üíï","üíû","üíì","üíó","üíñ","üíò","üíù","üíü","üíú","üíõ","üíö","üíô","üèÉ","üèÉüèª","üèÉüèº","üèÉüèΩ","üèÉüèæ","üèÉüèø","üö∂","üö∂üèª","üö∂üèº","üö∂üèΩ","üö∂üèæ","üö∂üèø","üíÉ","üíÉüèª","üíÉüèº","üíÉüèΩ","üíÉüèæ","üíÉüèø","üö£","üö£üèª","üö£üèº","üö£üèΩ","üö£üèæ","üö£üèø","üèä","üèäüèª","üèäüèº","üèäüèΩ","üèäüèæ","üèäüèø","üèÑ","üèÑüèª","üèÑüèº","üèÑüèΩ","üèÑüèæ","üèÑüèø","üõÄ","üõÄüèª","üõÄüèº","üõÄüèΩ","üõÄüèæ","üõÄüèø","üèÇ","üéø","‚õÑÔ∏è","üö¥","üö¥üèª","üö¥üèº","üö¥üèΩ","üö¥üèæ","üö¥üèø","üöµ","üöµüèª","üöµüèº","üöµüèΩ","üöµüèæ","üöµüèø","üèá","üèáüèª","üèáüèº","üèáüèΩ","üèáüèæ","üèáüèø","‚õ∫Ô∏è","üé£","‚öΩÔ∏è","üèÄ","üèà","‚öæÔ∏è","üéæ","üèâ","‚õ≥Ô∏è","üèÜ","üéΩ","üèÅ","üéπ","üé∏","üéª","üé∑","üé∫","üéµ","üé∂","üéº","üéß","üé§","üé≠","üé´","üé©","üé™","üé¨","üé®","üéØ","üé±","üé≥","üé∞","üé≤","üéÆ","üé¥","üÉè","üÄÑÔ∏è","üé†","üé°","üé¢","üöÉ","üöû","üöÇ","üöã","üöù","üöÑ","üöÖ","üöÜ","üöá","üöà","üöâ","üöä","üöå","üöç","üöé","üöê","üöë","üöí","üöì","üöî","üö®","üöï","üöñ","üöó","üöò","üöô","üöö","üöõ","üöú","üö≤","üöè","‚õΩÔ∏è","üöß","üö¶","üö•","üöÄ","üöÅ","‚úàÔ∏è","üí∫","‚öìÔ∏è","üö¢","üö§","‚õµÔ∏è","üö°","üö†","üöü","üõÇ","üõÉ","üõÑ","üõÖ","üí¥","üí∂","üí∑","üíµ","üóΩ","üóø","üåÅ","üóº","‚õ≤Ô∏è","üè∞","üèØ","üåá","üåÜ","üåÉ","üåâ","üè†","üè°","üè¢","üè¨","üè≠","üè£","üè§","üè•","üè¶","üè®","üè©","üíí","‚õ™Ô∏è","üè™","üè´","‚åöÔ∏è","üì±","üì≤","üíª","‚è∞","‚è≥","‚åõÔ∏è","üì∑","üìπ","üé•","üì∫","üìª","üìü","üìû","‚òéÔ∏è","üì†","üíΩ","üíæ","üíø","üìÄ","üìº","üîã","üîå","üí°","üî¶","üì°","üí≥","üí∏","üí∞","üíé","üåÇ","üëù","üëõ","üëú","üíº","üéí","üíÑ","üëì","üëí","üë°","üë†","üë¢","üëû","üëü","üëô","üëó","üëò","üëö","üëï","üëî","üëñ","üö™","üöø","üõÅ","üöΩ","üíà","üíâ","üíä","üî¨","üî≠","üîÆ","üîß","üî™","üî©","üî®","üí£","üö¨","üî´","üîñ","üì∞","üîë","‚úâÔ∏è","üì©","üì®","üìß","üì•","üì§","üì¶","üìØ","üìÆ","üì™","üì´","üì¨","üì≠","üìÑ","üìÉ","üìë","üìà","üìâ","üìä","üìÖ","üìÜ","üîÖ","üîÜ","üìú","üìã","üìñ","üìì","üìî","üìí","üìï","üìó","üìò","üìô","üìö","üìá","üîó","üìé","üìå","‚úÇÔ∏è","üìê","üìç","üìè","üö©","üìÅ","üìÇ","‚úíÔ∏è","‚úèÔ∏è","üìù","üîè","üîê","üîí","üîì","üì£","üì¢","üîà","üîâ","üîä","üîá","üí§","üîî","üîï","üí≠","üí¨","üö∏","üîç","üîé","üö´","‚õîÔ∏è","üìõ","üö∑","üöØ","üö≥","üö±","üìµ","üîû","üâë","üâê","üíÆ","„äôÔ∏è","„äóÔ∏è","üà¥","üàµ","üà≤","üà∂","üàöÔ∏è","üà∏","üà∫","üà∑","üàπ","üà≥","üàÇ","üàÅ","üàØÔ∏è","üíπ","‚ùáÔ∏è","‚ú≥Ô∏è","‚ùé","‚úÖ","‚ú¥Ô∏è","üì≥","üì¥","üÜö","üÖ∞","üÖ±","üÜé","üÜë","üÖæ","üÜò","üÜî","üÖøÔ∏è","üöæ","üÜí","üÜì","üÜï","üÜñ","üÜó","üÜô","üèß","‚ôàÔ∏è","‚ôâÔ∏è","‚ôäÔ∏è","‚ôãÔ∏è","‚ôåÔ∏è","‚ôçÔ∏è","‚ôéÔ∏è","‚ôèÔ∏è","‚ôêÔ∏è","‚ôëÔ∏è","‚ôíÔ∏è","‚ôìÔ∏è","üöª","üöπ","üö∫","üöº","‚ôøÔ∏è","üö∞","üö≠","üöÆ","‚ñ∂Ô∏è","‚óÄÔ∏è","üîº","üîΩ","‚è©","‚è™","‚è´","‚è¨","‚û°Ô∏è","‚¨ÖÔ∏è","‚¨ÜÔ∏è","‚¨áÔ∏è","‚ÜóÔ∏è","‚ÜòÔ∏è","‚ÜôÔ∏è","‚ÜñÔ∏è","üîÑ","‚Ü™Ô∏è","‚Ü©Ô∏è","‚§¥Ô∏è","‚§µÔ∏è","üîÄ","üîÅ","üîÇ","üîü","üî¢","üî§","üî°","üî†","üì∂","üé¶","üî£","üîÉ","üí±","üí≤","‚û∞","‚ûø","„ÄΩÔ∏è","üîö","üîô","üîõ","üîù","üîú","üåÄ","‚ìÇÔ∏è","‚õé","üîØ","üî∞","üî±","‚ö†Ô∏è","‚ô®Ô∏è","‚ôªÔ∏è","üí¢","üí†","‚òëÔ∏è","‚ö™Ô∏è","üïê","üïë","üïí","üïì","üïî","üïï","üïñ","üïó","üïò","üïô","üïö","üïõ","üïú","üïù","üïû","üïü","üï†","üï°","üï¢","üï£","üï§","üï•","üï¶","üïß"];
const {loadData, memberLevel} = require("./data");
const {birthday} = require("./moment");
const emojiRegex = require('emoji-regex');
const regex = emojiRegex();
var timer = [];

function get_random (list) {
  return list[Math.floor((Math.random()*list.length))];
}

function cFL(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}

function callName(client, guildid, datafile, fusotime){
  function everyMinute(){
  try{
    var data = loadData(datafile);
    var guild = client.guilds.cache.get(guildid);
    guild.channels.cache.forEach(channel => {
      if(channel.parentId !== "720275637415182420") return;
      if(!channel.name.includes("‚îä")) return;
      channel.members.forEach(member => {
        if(memberLevel(member) < 30) return;
        if(data.memberList[member.user.id].birthday == birthday(Date.now(), fusotime)){
          var gdvcallname = "üéä‚îä"+member.user.username
          if(channel.name == gdvcallname) return;
          if(channel.name.includes("üéä")) return;
          console.log("Gdversariante or new member present in the voice channel (features)");
          channel.setName("üéä‚îä"+member.user.username);
        }
      });
    });
  }catch(e){console.log(e)}
  }

  function every15Minutes(){
  try{
    var guild = client.guilds.cache.get(guildid);
    guild.members.fetch().then(members => { members.forEach(member => {
      try{
        let m = member
        member.presence.activities.forEach(function(activity){

          if(activity.applicationId == "700136079562375258"){
            //VALORANT
            console.log(m.user.username, "---", activity);
          }
          if(activity.applicationId == "401518684763586560"){
            //LoL
            console.log(m.user.username, "---", activity);
          }
          if(activity.applicationId == "821361671729709086"){
            //BlueStacks 5
            console.log(m.user.username, "---", activity);
          }

        });
      }catch(e){}      
    })}).catch(console.error);
  }catch(e){console.log(e)}
  }

  function memberCounter(){
  try{
    const guild = client.guilds.cache.get(guildid);
    const memberRole = guild.roles.cache.get('721660842176806965');
    const counter = memberRole.members.size;
    console.log("Updating channel topic: " + counter + " (features)");
    var counterEmoji = counter.toString();
    counterEmoji = counterEmoji.replace(/0/gi ,"0Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/1/gi ,"1Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/2/gi ,"2Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/3/gi ,"3Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/4/gi ,"4Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/5/gi ,"5Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/6/gi ,"6Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/7/gi ,"7Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/8/gi ,"8Ô∏è‚É£");
    counterEmoji = counterEmoji.replace(/9/gi ,"9Ô∏è‚É£");
    const channel = client.channels.cache.get("720275637860040784");
    channel.setTopic(`Chat geral! Contador de membros: ${counterEmoji}`);
  }catch(e){console.log(e)}
  }

  everyMinute();
  every15Minutes();
  memberCounter();
  var loop1 = setInterval(function(){ everyMinute(); }, 30000);
  var loop2 = setInterval(function(){ every15Minutes(); }, 60000*15);
  var loop3 = setInterval(function(){ memberCounter(); }, 60000*10);
}

function commands(client, message, prefix, guildid){
  try{
  if(!message.content.startsWith(prefix)) return;
  var msg = message.content.split(" ");
  msg = msg.filter((a) => a);

  if(msg[0] == "/callname" || "/renomear"){
    //Check channel
    if(message.channel.id !== "771257420470157322") return;

    console.log("New command! (features)");
    console.log(msg);
    const guild = client.guilds.cache.get(guildid)
    guild.members.fetch(message.author.id).then((user) => {
      if(memberLevel(user) < 50) return message.reply({content: "Para usar esse comando voc√™ precisa ser LvL 50 aqui no servidor. Para saber como verificar seu n√≠vel leia o canal <#768686751291408424>."}).catch();
      const vChannel = message.member.voice.channel;
      if (!vChannel) return message.reply({content: "Entre em um canal para poder trocar o nome dele!"}).catch();
      if(vChannel.parentId !== "720275637415182420") return message.reply({content: "Entre em um canal v√°lido para renomea-lo!"}).catch();
      if(!vChannel.name.includes("‚îä")) return message.reply({content: "Entre em um canal v√°lido para renomea-lo!"}).catch();
      if(!msg[1]) return message.reply({content: "Para trocar o nome do canal de voz mande **/callname (emoji) (nome)**. "}).catch();
      if(timer[vChannel.id] && (((Date.now()-timer[vChannel.id]) / 1000) <= 300 )) return message.reply({content: "O Discord s√≥ permite a troca do nome do canal a cada 5 minutos. Tente renomear outro canal de voz ou aguarde e tente novamente em **" + parseInt(300 - ((Date.now()-timer[vChannel.id]) / 1000)) + " segundos** para poder alterar o nome desse!" }).catch();

      //Emoji and text
      var match = msg[1].match(regex);
      if(!match) {
        match = get_random(allEmojis).match(regex);
        var text = msg;
        text.shift();
      } else{
        var text = msg;
        text.shift();
        text.shift();
      }
      const emojiarray = match[0];
      const emoji = [...emojiarray][0];
      

      //Text
      text = text.join(" ");
      const match2 = text.match(regex)
      if(match2) return message.reply({content: "N√£o utilize emojis no campo de nome do comando. Para usar esse comando mande **/callname (emoji) (nome)**."}).catch();
      text = cFL(text);
      if(text.lenth > 10) return message.reply({content: "O campo de nome n√£o pode ter mais de 15 caracteres. Para usar esse comando mande **/callname (emoji) (nome)**."}).catch();

      //Name
      const name = emoji + "‚îä" + text;
      console.log(name);
      message.reply({content: `Trocando o nome do canal para: **${name}**\n\nSe em at√© 10 segundos o nome n√£o mudar tente novamente daqui 5 minutos devido as limita√ß√µes do Discord.`});
      vChannel.setName(name).then(channel => {
        console.log("New name in voice channel (features)");
        timer[vChannel.id] = Date.now();
        message.reply({content: "Pronto! O canal foi renomeado com sucesso!"}).catch();
      }).catch(console.error);
    });
  }
  }catch(e){console.log(e)}
}

module.exports = {
    callName: callName,
    commands: commands
};